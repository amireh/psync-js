define("psync/error",[],function(){var e,n,r;return e=function(e){throw"string"==typeof e?new Error(e):e},r=function(){return e.apply(this,arguments)},r.configure=function(r){n=e,e=r},r.restore=function(){e=n,n=void 0},r}),define("psync/util/evented",["require","pixy/mixins/events"],function(e){var n=e("pixy/mixins/events");return n}),define("psync/config",["require","lodash","./util/evented"],function(e){var n=e("lodash"),r=e("./util/evented"),t=n.extend,o={},c=function(){return this}();return o.adapter=null,o.unrecoverableResponseCodes=[422,400],o.persistent=!0,o.rootScope=void 0,o.debug=!1,t(c,r),o.trigger=c.trigger.bind(c),o.on=c.on.bind(c),o.off=c.off.bind(c),o}),define("psync/journal/processors/create",["require","psync/config"],function(e){var n=e("psync/config");return function(e){var r=n.adapter,t={id:r.getShadowId(e),data:r.serialize(e,"create")};return t}}),define("psync/journal/processors/update",["require","psync/config"],function(e){var n=e("psync/config");return function(e){var r=n.adapter,t=r.getId(e);return t?{id:t,data:r.serialize(e,"update")}:void 0}}),define("psync/journal/processors/delete",["require","psync/config"],function(e){var n=e("psync/config");return function(e){var r=n.adapter,t=r.getId(e);return t?{id:t}:void 0}}),define("psync/journal",["require","lodash","psync/config","psync/util/evented","./journal/processors/create","./journal/processors/update","./journal/processors/delete"],function(e){var n,r=e("lodash"),t=e("psync/config"),o=e("psync/util/evented"),c=e("./journal/processors/create"),i=e("./journal/processors/update"),s=e("./journal/processors/delete"),u=r.extend,a=r.findWhere,p=Object.keys,l=function(e){return e?Array.isArray(e)?e:[e]:[]},d=function(e,n){return a(n,{path:e})},f=function(e,n){var r={path:e,operations:{}};return n.push(r),r},y=function(e,n,r){e.operations[n]=e.operations[n]||[],e.operations[n].push(r)},v=function(e,n,r){var t,o=e.operations[n];return o&&(t=o.indexOf(r),-1!==t)?(o.splice(t,1),!0):void 0},h=function(e,n){var r;r=n.indexOf(e),-1!==r&&n.splice(r,1)},g=function(e){return p(e.operations).reduce(function(n,r){return n+=l(e.operations[r]).length},0)},b=function(){return this.records=[],this},x=function(){n.trigger("change")};return u(b.prototype,o,{add:function(e,n){var r,o=this.records,u=t.adapter.getPathFor(n),a=d(u,o)||f(u,o);switch(e){case"create":r=c(n);break;case"update":r=i(n);break;case"delete":r=s(n)}return r&&(y(a,e,r),x()),r},remove:function(e,n,r){var o=t.adapter.getPathFor(n),c=d(o,this.records);return c&&v(c,e,r)?(g(c)||h(c,this.records),x(),!0):void 0},clear:function(){this.isEmpty()||(this.records=[],x())},isEmpty:function(){return 0===this.length},get:function(e){return d(e,this.records)},getEntries:function(e,n){var r=this.get(e);return r?l(r.operations[n]):void 0},toJSON:function(){return{records:this.records}}}),Object.defineProperty(b.prototype,"length",{get:function(){return this.records.reduce(function(e,n){return e+=g(n)},0)}}),n=new b}),define("psync/player/resolver",["require","inflection","../error","psync/config"],function(e){var n=(e("inflection"),e("../error")),r=e("psync/config"),t={},o=function(e){return e.underscore().pluralize().camelize(!0)},c=function(e,t,c){var i,s,u=c||r.rootScope;return u?(i=u[o(e)])?(s=i.get(""+t),s||console.error('Unable to resolve scope "'+e+'" with id:',t),s):void console.error('Unknown scope "'+e+'"'):n("You must either pass a container or set one in Psync.config.rootScope.")},i=function(e,n){return n[o(e)]},s=function(e){var n,r,t,o,i=[].concat(e);for(""===i[0]&&i.shift(),o=0;o<i.length;++o)r=i[o],t=i[++o],n=c(r,t,n);return{scope:n,key:r,id:t}};return t.resolveScope=c,t.resolveScopeFromChain=s,t.resolveCollection=i,t}),define("psync/player/traverse",["require","./resolver","rsvp"],function(e){var n=e("./resolver"),r=e("rsvp"),t=Object.keys,o=n.resolveScopeFromChain,c=n.resolveCollection,i=function(e,n){var i=[];return n=n||{},e.forEach(function(e){var s,u,a,p,l,d,f=e.path.split("/"),y=f.pop();return p=o(f),s=p.scope,u=p.key,a=p.id,s?(l=c(y,s))?(d=e.operations,void t(d).forEach(function(t){var o=d[t];o.length&&(n.postProcess||n[t])&&o.forEach(function(o){var c,a=r.resolve();n[t]&&(a=n[t](s,l,o),i.push(a)),n.postProcess&&(c=n.postProcess.bind(null,{scope:s,scopeKey:u,collection:l,collectionKey:y,path:e.path,entry:o,opCode:t}),a=a.then(function(e){return c({success:!0,output:e})},function(e){return c({success:!1,output:e})}),i.push(a)),a=void 0})})):void console.warn("Unable to resolve collection at:",e.path):void console.warn("Unable to resolve scope at:",e.path)}),r.all(i)};return i}),define("psync/player",["require","pixy","rsvp","./player/traverse"],function(e){var n,r,t,o=e("pixy"),c=e("rsvp"),i=e("./player/traverse"),s=new o.Object,u=c.all,a="playbackMode",p="rollbackMode",l=function(e,n,r){var t,o=r.id;return o=""+o,t=n.get(o),t?c.resolve(o):(t=n.push({id:o}),t.fetch().then(function(){return t.get("id")},function(e){return n.remove(o),e}))},d=function(e,t,o){var i=""+o.id,s=t.get(i);return s?n===a&&r?c.resolve(i):s.fetch().then(function(){return s.get("id")}):l(e,t,o)},f=function(e,n,r){var t=""+r.id,o=n.get(t);return o&&n.remove(o),c.resolve(t)},y=function(e,t){var o;if(t.success){if(o=e.opCode,n===p)switch(e.opCode){case"create":o="delete";break;case"delete":o="create";break;case"update":o="update"}[e.collectionKey+":"+o,"change"].forEach(function(o){s.trigger(o,t.output,{path:e.path,rollingBack:n===p,selfOrigin:!!r})})}},v=function(){return this};return v.prototype.play=function(e,t){var o;return r=t,o=[],e.processed&&(n=a,o.concat([i(e.processed||[],{postProcess:y,create:l,update:d,"delete":f})])),e.dropped&&t&&(n=p,o.concat([i(e.dropped||[],{postProcess:y,create:f,update:d,"delete":l})])),u(o)},["on","off"].forEach(function(e){v.prototype[e]=s[e].bind(s)}),t=new v}),define("psync/adapters/pixy/sync",["require","pixy","lodash","psync/journal","psync/config"],function(e){var n=e("pixy"),r=e("lodash"),t=e("psync/journal"),o=e("psync/config"),c=r.result,i=r.contains,s=n.sync,u={create:"create",update:"update",patch:"update","delete":"delete"},a=function(e,n){var r,a,p,l=c(n,"isJournalled",n);return l&&(a=u[e],a&&(p=t.add(a,n))),r=s.apply(this,arguments),p&&!o.debug&&(r.then(function(){t.remove(a,n,p)}),r.then(null,function(e){e=e||{},i(o.unrecoverableResponseCodes,e.status)&&t.remove(a,n,p)})),r};return a.install=function(){n.sync=a},a.restore=function(){n.sync=s},a}),define("psync/adapters/pixy/resolver",["require","lodash"],function(e){var n,r=e("lodash"),t=r.result,o=function(e){return e.psync?t(e,"psync",e):e.collection?t(e.collection,"psync",e.collection):void 0},c=function(e,n){return e[n]?t(e,n,e):e.collection?t(e.collection,n,e.collection):void 0};return n={},n.getScope=c,n.getConfig=o,n}),define("psync/path_builder",["require","lodash","psync/error"],function(e){var n=e("lodash"),r=e("psync/error"),t=n.result,o=function(e){return"/"!==e[0]?"/"+e:e.replace(/^\/+/,"/")},c=function(e,n,i){var s,u,a=[],p=n(e);if(!p.path&&!p.collectionKey)return r("Model must configure either @psync.path or @psync.collectionKey.");if(p.path)return t(p,"path",e);if(s=p.scopeKey){if(u=i(e,s),!u)return r("Expected model scope to be found at `this.collection."+s+"`.");a.unshift(u.get("id")),a.unshift(c(u,n,i))}return a.push(p.collectionKey),o(a.join("/"))};return c}),define("psync/adapters/pixy/model",["require","psync/error","psync/adapters/pixy/resolver"],function(e){var n=e("psync/error"),r=e("psync/adapters/pixy/resolver"),t={psync:{collectionKey:void 0,path:void 0,scopeKey:void 0,scopeId:void 0},__initialize__:function(){this.collection||n("Psync model must belong to a collection.")},isJournalled:function(){return this.collection&&!!r.getConfig(this)},toPsync:function(){var e=this.toJSON();return delete e.id,e}};return t}),define("psync/adapters/pixy",["require","./pixy/sync","./pixy/resolver","psync/path_builder","./pixy/model"],function(e){var n=e("./pixy/sync"),r=e("./pixy/resolver"),t=e("psync/path_builder"),o=e("./pixy/model"),c={ModelMixin:o,install:function(){n.install()},uninstall:function(){n.restore()},getShadowId:function(e){return e.cid},getId:function(e){return e.get("id")},getPathFor:function(e){return t(e,r.getConfig,r.getScope)},serialize:function(e,n){return e.toPsync("update"===n)}};return c}),define("psync/persistence",["require","psync/config","psync/journal"],function(e){var n,r=e("psync/config"),t=e("psync/journal"),o={},c=function(){t.isEmpty()?localStorage.removeItem("journal"):localStorage.setItem("journal",JSON.stringify(t.toJSON()))},i=o.enable=function(){n||(t.on("change",c),n=!0)},s=o.disable=function(){n&&(t.off("change",c),n=!1)};return r.on("change",function(){r.persistent?i():s()}),o}),define("psync",["require","./psync/error","./psync/journal","./psync/player","./psync/config","./psync/adapters/pixy","./psync/persistence"],function(e){var n,r=e("./psync/error"),t=e("./psync/journal"),o=e("./psync/player"),c=e("./psync/config"),i=e("./psync/adapters/pixy"),s=e("./psync/persistence");return n={},n.Journal=t,n.Player=o,n.onError=r,n.Persistence=s,n.Adapters={Pixy:i},n.configure=function(e,n){var t;return c.hasOwnProperty(e)?(t=c[e],void 0!==n&&(c[e]=n,c.trigger("change")),t):r("Unknown Psync configuration property '"+e+"'")},n});