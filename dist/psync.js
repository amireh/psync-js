define("psync/error",[],function(){var n,e,r;return n=function(n){throw"string"==typeof n?new Error(n):n},r=function(){return n.apply(this,arguments)},r.configure=function(r){e=n,n=r},r.restore=function(){n=e,e=void 0},r}),define("psync/util/evented",["require","pixy/mixins/events"],function(n){var e=n("pixy/mixins/events");return e}),define("psync/config",["require","lodash","./util/evented"],function(n){var e=n("lodash"),r=n("./util/evented"),t=e.extend,o={},i=new function(){return this};return t(i,r),o.adapter=null,o.unrecoverableResponseCodes=[422,400],o.persistent=!0,o.rootScope=void 0,o.trigger=i.trigger.bind(i),o.on=i.on.bind(i),o.off=i.off.bind(i),o}),define("psync/journal/processors/create",["require","psync/config"],function(n){var e=n("psync/config");return function(n){var r=e.adapter,t={id:r.getShadowId(n),data:r.serialize(n)};return t}}),define("psync/journal",["require","lodash","psync/config","psync/util/evented","./journal/processors/create"],function(n){var e,r=n("lodash"),t=n("psync/config"),o=n("psync/util/evented"),i=n("./journal/processors/create"),c=r.extend,s=r.findWhere,u=Object.keys,a=function(n){return n?Array.isArray(n)?n:[n]:[]},p=function(n,e){return s(e,{path:n})},f=function(n,e){var r={path:n,operations:{}};return e.push(r),r},d=function(n,e,r){n.operations[e]=n.operations[e]||[],n.operations[e].push(r)},l=function(n,e,r){var t,o=n.operations[e];return o&&(t=o.indexOf(r),-1!==t)?(o.splice(t,1),!0):void 0},y=function(n,e){var r;r=e.indexOf(n),-1!==r&&e.splice(r,1)},h=function(n){return u(n.operations).reduce(function(e,r){return e+=a(n.operations[r]).length},0)},g=function(){return this.records=[],this},v=function(){e.trigger("change")};return c(g.prototype,o,{add:function(n,e){var r,o=this.records,c=t.adapter.getPathFor(e),s=p(c,o)||f(c,o);switch(n){case"create":r=i(e)}return r&&(d(s,n,r),v()),r},remove:function(n,e,r){var o=t.adapter.getPathFor(e),i=p(o,this.records);return i&&l(i,n,r)?(h(i)||y(i,this.records),v(),!0):void 0},clear:function(){this.isEmpty()||(this.records=[],v())},isEmpty:function(){return 0===this.length},get:function(n){return p(n,this.records)},getEntries:function(n,e){var r=this.get(n);return r?a(r.operations[e]):void 0},toJSON:function(){return{records:this.records}}}),Object.defineProperty(g.prototype,"length",{get:function(){return this.records.reduce(function(n,e){return n+=h(e)},0)}}),e=new g}),define("psync/adapters/pixy/sync",["require","pixy","lodash","psync/journal","psync/config"],function(n){var e=n("pixy"),r=n("lodash"),t=n("psync/journal"),o=n("psync/config"),i=r.result,c=r.contains,s=e.sync,u={create:"create",update:"update",patch:"update","delete":"delete"},a=function(n,e){var r,a,p,f=i(e,"isJournalled",e);return f&&(a=u[n],a&&(p=t.add(a,e))),r=s.apply(this,arguments),p&&(r.then(function(){t.remove(a,e,p)}),r.then(null,function(n){n=n||{},c(o.unrecoverableResponseCodes,n.status)&&t.remove(a,e,p)})),r};return a.install=function(){e.sync=a},a.restore=function(){e.sync=s},a}),define("psync/adapters/pixy/resolver",["require","lodash"],function(n){var e,r=n("lodash"),t=r.result,o=function(n){return n.psync?t(n,"psync",n):n.collection?t(n.collection,"psync",n.collection):void 0},i=function(n,e){return n[e]?t(n,e,n):n.collection?t(n.collection,e,n.collection):void 0};return e={},e.getScope=i,e.getConfig=o,e}),define("psync/path_builder",["require","lodash","psync/error"],function(n){var e=n("lodash"),r=n("psync/error"),t=e.result,o=function(n){return"/"!==n[0]?"/"+n:n.replace(/^\/+/,"/")},i=function(n,e,c){var s,u,a=[],p=e(n);if(!p.path&&!p.collectionKey)return r("Model must configure either @psync.path or @psync.collectionKey.");if(p.path)return t(p,"path",n);if(s=p.scopeKey){if(u=c(n,s),!u)return r("Expected model scope to be found at `this.collection."+s+"`.");a.unshift(u.get("id")),a.unshift(i(u,e,c))}return a.push(p.collectionKey),o(a.join("/"))};return i}),define("psync/adapters/pixy",["require","./pixy/sync","./pixy/resolver","psync/path_builder"],function(n){var e=n("./pixy/sync"),r=n("./pixy/resolver"),t=n("psync/path_builder"),o={install:function(){e.install()},uninstall:function(){e.restore()},getShadowId:function(n){return n.cid},getId:function(n){return n.get("id")},getPathFor:function(n){return t(n,r.getConfig,r.getScope)},serialize:function(n){return n.toPsync()}};return o}),define("psync/persistence",["require","psync/config","psync/journal"],function(n){var e,r=n("psync/config"),t=n("psync/journal"),o={},i=function(){t.isEmpty()?localStorage.removeItem("journal"):localStorage.setItem("journal",JSON.stringify(t.toJSON()))},c=o.enable=function(){e||(t.on("change",i),e=!0)},s=o.disable=function(){e&&(t.off("change",i),e=!1)};return r.on("change",function(){r.persistent?c():s()}),o}),define("psync",["require","./psync/error","./psync/journal","./psync/config","./psync/adapters/pixy","./psync/persistence"],function(n){{var e,r=n("./psync/error"),t=n("./psync/journal"),o=n("./psync/config"),i=n("./psync/adapters/pixy");n("./psync/persistence")}return e={},e.journal=t,e.onError=r,e.Adapters={Pixy:i},e.configure=function(n,e){var t;return o.hasOwnProperty(n)?(t=o[n],void 0!==e&&(o[n]=e,o.trigger("change")),t):r("Unknown Psync configuration property '"+n+"'")},e});